# B2B Mix Search Plugin

## Описание
Плагин `B2B Mix search` предоставляет функционал для обработки кастомных поисковых запросов, включая:
- Интеграцию с WooCommerce для проверки и создания продуктов.
- Поддержку API поиска с внешнего источника.
- Поддержку REST API для обработки запросов.

## Основные возможности
1. Обработка запросов через REST API.
2. Интеграция с WooCommerce: проверка существующих продуктов и их автоматическое создание.
3. Установка мета-данных для продуктов, включая цену, бренд и изображения.
4. Поддержка Polylang и WPML для многоязычности.
5. Использование фильтров и хуков для расширения функциональности.

## Требования
- WordPress версии 5.9 или выше.
- PHP версии 7.2 или выше.
- WooCommerce установлен и активирован.

## Установка
1. Скопируйте файлы плагина в директорию `wp-content/plugins/b2b-mix-search`.
2. Активируйте плагин через админ-панель WordPress.
3. Настройте API-ключи и доступ к внешним сервисам при необходимости.

## Использование
- Для поиска данных используйте REST API маршруты:
  - `/jet-search/v1/search-posts/` для выполнения стандартного поиска.
  - `/b2b_debug/v1/custom-search/` для отладки или тестового поиска.

## Изменения и улучшения
1. Комментарии и читаемость
- Подробные комментарии ко всем функциям, параметрам и их действиям. Это позволяет лучше понимать, что делает каждая часть кода, особенно при передаче проекта другим разработчикам.
- Логические блоки разделены (например, обработка изображений вынесена в отдельную функцию).
2. Безопасность
- Использование функций очистки данных: sanitize_text_field(), sanitize_title(), esc_url() — для очистки входящих данных от потенциально вредоносного содержимого.
- Проверка входных данных перед их использованием: Например, для параметра lang или данных data из $request.
- Защита от XSS (межсайтовый скриптинг) и SQL-инъекций.
3. Локализация
- Поддержка перевода текста с использованием функций локализации (__() и load_plugin_textdomain()).
- Настроен Text Domain: b2b-mix-search, чтобы весь текст мог быть переведен через .po/.mo файлы.
- Возможность перевода плагина на любой язык.
4. Разделение логики
- Выделены отдельные функции для обработки изображений, создания продуктов, проверки существования продуктов, и взаимодействия с API.
- Логика поиска и обработки данных теперь сосредоточена в своей области (методы класса или функции).
- Код стал модульным и проще в поддержке. Новую функциональность легче добавлять, не затрагивая остальную часть плагина.
5. Оптимизация
- Убраны ненужные вызовы фильтров и операций. Например, фильтр wp_query_search_exclusion_prefix включается и выключается только в нужных местах.
- Переменные четко именуются, чтобы их роль была понятна из названия.
- Код стал быстрее и эффективнее.
- Уменьшено количество потенциальных ошибок.
6. Отладка
- Улучшен метод отладки с помощью REST API.
- Сообщения об ошибках возвращаются в читаемом виде, чтобы было проще находить причины неполадок.
- Проще находить ошибки при разработке и интеграции.
7. Дополнительные улучшения
- Работа с изображениями -добавлено: Генерация метаданных для изображений. Привязка изображения как миниатюры для продукта.